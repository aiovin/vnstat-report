# vnstat-report
Bash —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ `vnstat --oneline` –∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ Telegram –∏–ª–∏ ntfy.sh

<img src="https://raw.githubusercontent.com/aiovin/vnstat-report/refs/heads/main/total.png"> <img src="https://raw.githubusercontent.com/aiovin/vnstat-report/refs/heads/main/daily.png">

## üì• –°–∫–∞—á–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç

–°–∫–∞—á–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –≤ –ª—é–±–æ–µ —É–¥–æ–±–Ω–æ–µ –º–µ—Å—Ç–æ –∏ —Å–¥–µ–ª–∞–π—Ç–µ –µ–≥–æ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º:

```bash
curl -o vnstat-report.sh https://raw.githubusercontent.com/aiovin/vnstat-report/refs/heads/main/vnstat-report.sh
```

```bash
chmod +x vnstat-report.sh
```

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞

–û—Ç–∫—Ä–æ–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```
MSG_TYPE="tg"                    # –¢–∏–ø —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (tg/ntfy)

BOT_TOKEN="–≤–∞—à_—Ç–æ–∫–µ–Ω"            # Telegram —Ç–æ–∫–µ–Ω
CHAT_ID="–≤–∞—à_chat_id"            # ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è/—á–∞—Ç–∞

NTFY_TOPIC="–≤–∞—à_—Ç–æ–ø–∏–∫"           # –í–∞—à —Ç–æ–ø–∏–∫ ntfy
```
–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–≥–æ —Ç–∏–ø–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –º–æ–∂–Ω–æ –Ω–µ –∑–∞–ø–æ–ª–Ω—è—Ç—å.

## –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Ç–∏–ø –æ—Ç—á–µ—Ç–∞
–î–æ–±–∞–≤—å—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∫–ª—é—á–∏ –∫ –∫–æ–º–∞–Ω–¥–µ –∑–∞–ø—É—Å–∫–∞ —Å–∫—Ä–∏–ø—Ç–∞.

| –ö–ª—é—á             | –û–ø–∏—Å–∞–Ω–∏–µ                                                              |
| ---------------- | --------------------------------------------------------------------- |
| –ë–µ–∑ –∫–ª—é—á–µ–π      | –ü—Ä–∏–¥–µ—Ç –ø–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç, –≤–∫–ª—é—á–∞—é—â–∏–π —Ç—Ä–∞—Ñ–∏–∫ –∑–∞ –¥–µ–Ω—å, –º–µ—Å—è—Ü –∏ –≤—Å—ë –≤—Ä–µ–º—è                    |
| `-daily`         | –û—Ç—á–µ—Ç –∑–∞ –¥–µ–Ω—å  |
| `-monthly` | –û—Ç—á–µ—Ç –∑–∞ –º–µ—Å—è—Ü    |
| `-total` | –û—Ç—á–µ—Ç –∑–∞ –≤—Å–µ –≤—Ä–µ–º—è    |
| `-msgtype —Ç–∏–ø` | –ö—É–¥–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (tg/ntfy)    |
| `-host –∏–º—è` | –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ –∏–º—è —Ö–æ—Å—Ç–∞ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è    |
| `-debug` | –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å, –∫–∞–∫–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ, –Ω–æ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –µ–≥–æ    |

### –ü—Ä–∏–º–µ—Ä—ã
`bash vnstat-report.sh -debug` –ù–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–æ –≤—ã–≤–µ—Å—Ç–∏ –Ω–∞ —ç–∫—Ä–∞–Ω –µ–≥–æ —Ç–µ–∫—Å—Ç<br>
`bash vnstat-report.sh -daily` –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞ —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –¥–µ–Ω—å<br>
#### –ö–ª—é—á–∏ –º–æ–∂–Ω–æ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å, –Ω–∞–ø—Ä–∏–º–µ—Ä:<br>
–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–æ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å<br>
`bash vnstat-report.sh -daily -monthly -msgtype ntfy -host "MyVPS" -debug`<br><br>
–£–¥–∞–ª–∏—Ç–µ `-debug`, —á—Ç–æ–±—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á–µ—Ç (–Ω–µ –∑–∞–±—É–¥—å—Ç–µ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è tg –∏–ª–∏ ntfy!)

## üìÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ cron
–û–ø—Ä–µ–¥–µ–ª–∏–≤—à–∏—Å—å –∫–∞–∫–∏–µ –æ—Ç—á–µ—Ç—ã –≤–∞–º –Ω—É–∂–Ω—ã, –¥–æ–±–∞–≤—å—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –∑–∞–¥–∞—á–∏ –≤ cron

```
crontab -e
```

–î–æ–±–∞–≤—å—Ç–µ –∑–∞–¥–∞—á—É.<br>
–ü—Ä–∏–º–µ—Ä—ã:

–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –æ—Ç—á–µ—Ç –≤ 12 –Ω–æ—á–∏
```
0 0 * * * /–ø–æ–ª–Ω—ã–π/–ø—É—Ç—å/–∫/—Å–∫—Ä–∏–ø—Ç—É/vnstat-report.sh -daily >> /var/tmp/vnstat-report.log 2>&1
```

–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π (–í 00:00 –∫–∞–∂–¥–æ–≥–æ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞)
```
0 0 * * 1 /–ø–æ–ª–Ω—ã–π/–ø—É—Ç—å/–∫/—Å–∫—Ä–∏–ø—Ç—É/vnstat-report.sh >> /var/tmp/vnstat-report.log 2>&1
```

–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π (–í 23:00 –≤ –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–Ω—å –∫–∞–∂–¥–æ–≥–æ –º–µ—Å—è—Ü–∞)
```
0 23 28-31 * * [ "$(date +\%d -d tomorrow)" = "01" ] && /–ø–æ–ª–Ω—ã–π/–ø—É—Ç—å/–∫/—Å–∫—Ä–∏–ø—Ç—É/vnstat-report.sh -monthly >> /var/tmp/vnstat-report.log 2>&1
```

### –§–∞–π–ª –ª–æ–≥–æ–≤

```
/var/tmp/vnstat-report.log
```

> [!TIP]
> –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —É—Ç–∏–ª–∏—Ç—É `jq` –¥–ª—è —á–∏—Ç–∞–±–µ–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–æ–≤ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏–π<br>
> `sudo apt update && sudo apt install jq` –î–ª—è Debian/Ubuntu
